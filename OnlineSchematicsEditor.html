<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Online Schematics Editor — MVP</title>
    <!-- Prevent /favicon.ico 404s -->
    <link
      rel="icon"
      type="image/svg+xml"
      href="assets/schematics-favicon.svg"
    />
    <link rel="mask-icon" href="assets/schematics-mask.svg" color="#0ea5e9" />
    <style>
      :root {
        --bg: #0f1115;
        --panel: #161a22;
        --ink: #e6e6e6;
        --muted: #a5adbb;
        --accent: #61dafb;
        --danger: #ff6b6b;
        --ok: #4ade80;
        --grid: #2a2f3a;
        --grid-bold: #3a4150;
        --wire: #008000;
        --select: #f59e0b;
        --pin: #93c5fd;
        --component: #e2e8f0;
        --ghost: #64748b;
        --light-bg: #e8e8e8;
      }

      /* Light theme */
      [data-theme="light"] {
        --bg: var(--light-bg);
        --panel: #f5f5f5;
        --ink: #333333;
        --muted: #666666;
        --accent: #0ea5e9;
        --danger: #dc2626;
        --ok: #059669;
        --grid: #c8ccd0;
        --grid-bold: #9ca3af;
        --wire: #008000;
        --select: #f59e0b;
        --pin: #3b82f6;
        --component: #1f2937;
        --ghost: #6b7280;
      }

      html,
      body {
        height: 100%;
      }

      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, Segoe UI, Roboto, Helvetica,
          Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--ink);
        background: var(--bg);
        overflow: hidden;
      }

      .app {
        display: flex;
        flex-direction: column;
        height: 100%;
      }

      .app-body {
        display: flex;
        flex: 1;
        overflow: hidden;
        min-height: 0;
      }

      .center-column {
        display: flex;
        flex-direction: column;
        flex: 1;
        min-width: 400px;
        min-height: 0;
      }

      header {
        display: flex;
        align-items: center;
        gap: 0.25rem;
        padding: 0.5rem 0.75rem;
        background: var(--panel);
        border-bottom: 1px solid #22262f;
        z-index: 3;
        flex-shrink: 0;
      }

      [data-theme="light"] header {
        border-bottom: 1px solid #d1d5db;
      }

      /* Keep everything on one row (no wrap); we'll popup sub-types absolutely */
      header {
        flex-wrap: nowrap;
        align-items: center;
      }

      /* Thin vertical separator between mode buttons and components */
      .vsep {
        width: 1px;
        height: 32px;
        background: #22262f;
        margin: 0 0.125rem;
        border-radius: 1px;
      }

      /* Sub-type popup: small, only as wide as content, positioned under the Diode button */
      #paletteRow2 {
        position: absolute;
        display: none;
        width: max-content;
        /* only as wide as its contents */
        pointer-events: auto;
        z-index: 5;
        /* above header background */
      }

      #paletteRow2 select {
        width: auto;
        white-space: nowrap;
      }

      /* Capacitor subtype buttons */
      .capacitor-subtypes {
        display: flex;
        gap: 0.25rem;
      }

      .capacitor-subtypes button {
        padding: 0.35rem 0.5rem;
        min-width: 48px;
      }

      .capacitor-subtypes button svg {
        width: 32px;
        height: 16px;
      }

      .transistor-subtypes {
        display: flex;
        gap: 0.25rem;
      }

      .transistor-subtypes button {
        padding: 0.35rem 0.5rem;
        min-width: 48px;
      }

      .transistor-subtypes button svg {
        width: 32px;
        height: 24px;
      }

      /* Junction dot buttons - match text button dimensions */
      #junctionDotGroup button {
        padding: 0.45rem 0.5rem;
        min-width: 38px;
      }

      #junctionDotGroup button svg {
        width: 18px;
        height: 18px;
        display: block;
      }

      /* Undo/Redo buttons - match text button dimensions */
      #undoBtn,
      #redoBtn {
        padding: 0.45rem 0.5rem;
        min-width: 38px;
      }

      #undoBtn svg,
      #redoBtn svg {
        width: 18px;
        height: 18px;
        display: block;
      }

      /* Junction dot size selector */
      .junction-size-selector {
        display: flex;
        gap: 0.25rem;
        width: 100%;
      }

      .junction-size-option {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 0.3rem;
        min-width: 0;
      }

      .junction-size-option svg {
        display: block;
      }

      .junction-size-option.selected {
        border-color: var(--accent);
        background: rgba(97, 218, 251, 0.1);
      }

      [data-theme="light"] .junction-size-option.selected {
        background: rgba(59, 130, 246, 0.1);
      }

      .color-swatch {
        transition: all 0.2s ease;
      }

      .color-swatch:hover {
        transform: scale(1.1);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
      }

      .color-swatch.selected {
        border-color: var(--accent) !important;
        border-width: 3px !important;
        box-shadow: 0 0 0 2px var(--bg), 0 0 0 4px var(--accent);
      }

      header .group {
        display: flex;
        gap: 0.15rem;
        align-items: center;
        background: #0e1219;
        padding: 0.22rem;
        border-radius: 10px;
        border: 1px solid #1e2430;
        position: relative;
      }

      [data-theme="light"] header .group {
        background: #e5e7eb;
        border: 1px solid #d1d5db;
      }

      button {
        appearance: none;
        background: #0e1219;
        border: 1px solid #273042;
        color: var(--ink);
        padding: 0.45rem 0.6rem;
        border-radius: 8px;
        cursor: pointer;
        font-size: 0.92rem;
      }

      [data-theme="light"] button {
        background: #f9fafb;
        border: 1px solid #d1d5db;
      }

      button:hover {
        border-color: #3a4a68;
      }

      [data-theme="light"] button:hover {
        border-color: #9ca3af;
      }

      button:disabled {
        opacity: 0.4;
        cursor: not-allowed;
        border-color: #1e2430;
      }

      button:disabled:hover {
        border-color: #1e2430;
      }

      [data-theme="light"] button:disabled {
        opacity: 0.4;
        border-color: #d1d5db;
      }

      [data-theme="light"] button:disabled:hover {
        border-color: #d1d5db;
      }

      button.active {
        outline: 2px solid var(--accent);
      }

      button.danger {
        border-color: #623;
        color: #ffb3c7;
      }

      button.ok {
        border-color: #1b3;
        color: var(--ok);
      }

      button svg {
        display: block;
      }

      .inspector-tab-bar {
        display: flex;
        gap: 0.25rem;
        margin-bottom: 0.5rem;
      }

      .inspector-tab-btn {
        flex: 1;
        padding: 0.35rem 0.5rem;
        font-size: 0.9rem;
        border-radius: 6px;
        background: #10141c;
        border: 1px solid #273042;
        color: var(--ink);
      }

      .inspector-tab-btn.active {
        border-color: var(--accent);
        background: rgba(14, 165, 233, 0.15);
      }

      [data-theme="light"] .inspector-tab-btn {
        background: #f3f4f6;
        border: 1px solid #d1d5db;
      }

      [data-theme="light"] .inspector-tab-btn.active {
        background: rgba(14, 165, 233, 0.2);
        border-color: #0ea5e9;
      }

      .inspector-libraries {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
      }

      .library-search input[type="search"] {
        width: 100%;
        padding: 0.4rem 0.5rem;
        border-radius: 6px;
        border: 1px solid #273042;
        background: #0e1219;
        color: var(--ink);
      }

      [data-theme="light"] .library-search input[type="search"] {
        background: #fff;
        border: 1px solid #d1d5db;
      }

      .library-list {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
      }

      .library-section {
        border: 1px solid #1f2533;
        border-radius: 8px;
        overflow: hidden;
        background: #111622;
      }

      [data-theme="light"] .library-section {
        border: 1px solid #d1d5db;
        background: #f9fafb;
      }

      .library-header {
        width: 100%;
        text-align: left;
        padding: 0.5rem 0.75rem;
        border: none;
        background: transparent;
        color: var(--ink);
        font-weight: 600;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .library-symbols {
        list-style: none;
        margin: 0;
        padding: 0.25rem 0.75rem 0.75rem;
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
        font-size: 0.9rem;
      }

      .library-symbols li {
        padding: 0.25rem 0.35rem;
        border-radius: 4px;
        cursor: default;
      }

      .library-symbols li:hover {
        background: rgba(14, 165, 233, 0.1);
      }

      .library-header::before {
        content: "";
        width: 0;
        height: 0;
        border-left: 6px solid transparent;
        border-right: 6px solid transparent;
        border-top: 8px solid var(--ink);
        transition: transform 0.15s ease;
      }

      .library-section.collapsed .library-header::before {
        transform: rotate(-90deg);
      }

      .library-section.collapsed .library-symbols {
        display: none;
      }

      .library-context-menu {
        position: fixed;
        display: none;
        min-width: 160px;
        background: #10141c;
        border: 1px solid #273042;
        border-radius: 6px;
        box-shadow: 0 12px 32px rgba(0, 0, 0, 0.35);
        padding: 0.25rem 0;
        z-index: 2000;
      }

      [data-theme="light"] .library-context-menu {
        background: #ffffff;
        border: 1px solid #d1d5db;
        box-shadow: 0 12px 28px rgba(15, 23, 42, 0.2);
      }

      .library-context-action {
        width: 100%;
        padding: 0.45rem 0.8rem;
        border: none;
        background: none;
        color: var(--ink);
        text-align: left;
        font-size: 0.9rem;
        cursor: pointer;
      }

      .library-context-action:hover {
        background: rgba(14, 165, 233, 0.12);
      }

      /* Resizable panels */
      .panel {
        background: var(--panel);
        display: flex;
        flex-direction: column;
        overflow: hidden;
        position: relative;
        transition: width 0.2s ease;
        min-height: 0;
      }

      .panel.collapsed {
        overflow: hidden;
        min-width: 40px !important;
        flex-shrink: 0;
      }

      .panel-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0.5rem 0.75rem;
        background: var(--panel);
        border-bottom: 1px solid #22262f;
        overflow: hidden;
      }

      [data-theme="light"] .panel-header {
        border-bottom: 1px solid #d1d5db;
      }

      .panel.collapsed .panel-header {
        border-bottom: none;
        flex-direction: column;
        gap: 0.2rem;
        padding: 0.3rem 0.3rem;
        align-items: center;
      }

      .panel-header h2 {
        margin: 0;
        font-size: 1.05rem;
        color: #cbd5e1;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .panel.collapsed .panel-header h2 {
        font-size: 1.2rem;
        font-weight: bold;
      }

      .panel-toggle {
        background: none;
        border: 1px solid #273042;
        color: var(--muted);
        padding: 0.25rem 0.4rem;
        border-radius: 6px;
        cursor: pointer;
        font-size: 0.75rem;
        min-width: 24px;
        flex-shrink: 0;
      }

      .panel-toggle:hover {
        border-color: #3a4a68;
        color: var(--ink);
      }

      .panel-content {
        flex: 1;
        padding: 0.75rem;
        overflow-y: auto;
        overflow-x: hidden;
      }

      .panel.collapsed .panel-content {
        display: none;
        visibility: hidden;
        opacity: 0;
      }

      #left {
        border-right: 1px solid #22262f;
        width: 320px;
        max-width: 600px;
      }

      [data-theme="light"] #left {
        border-right: 1px solid #d1d5db;
      }

      #left:not(.collapsed) {
        min-width: 200px;
      }

      #right {
        border-left: 1px solid #22262f;
        width: 320px;
        max-width: 600px;
      }

      [data-theme="light"] #right {
        border-left: 1px solid #d1d5db;
      }

      #right:not(.collapsed) {
        min-width: 200px;
      }

      .resizer {
        width: 6px;
        background: transparent;
        cursor: col-resize;
        flex-shrink: 0;
        position: relative;
        z-index: 10;
      }

      .resizer:hover {
        background: rgba(97, 218, 251, 0.2);
      }

      .resizer.resizing {
        background: rgba(97, 218, 251, 0.4);
      }

      #center {
        flex: 1;
        display: flex;
        flex-direction: column;
        min-height: 0;
      }

      h2 {
        margin: 0.25rem 0 0.5rem;
        font-size: 1.05rem;
        color: #cbd5e1;
      }

      [data-theme="light"] h2 {
        color: #333333;
      }

      h3 {
        margin: 0.25rem 0 0.5rem;
        font-size: 0.95rem;
        color: #d8e2f1;
      }

      [data-theme="light"] h3 {
        color: #555555;
      }

      .section-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        cursor: pointer;
        user-select: none;
        margin: 0.25rem 0 0.5rem;
      }

      .section-header h2,
      .section-header h3 {
        margin: 0;
        flex: 1;
      }

      .section-toggle {
        font-size: 0.75rem;
        color: var(--muted);
        transition: transform 0.2s;
        padding: 0.25rem;
      }

      .section-toggle.collapsed {
        transform: rotate(-90deg);
      }

      .section-content {
        overflow: visible;
        transition: max-height 0.3s ease-out, opacity 0.2s ease-out;
        max-height: 5000px;
        opacity: 1;
      }

      .section-content.collapsed {
        max-height: 0;
        opacity: 0;
        margin: 0;
        overflow: hidden;
      }

      .row {
        display: flex;
        gap: 0.5rem;
        align-items: center;
        margin: 0.4rem 0;
      }

      label {
        color: var(--muted);
        font-size: 0.9rem;
      }

      input[type="text"],
      select,
      input[type="number"] {
        width: 100%;
        background: #0e1219;
        color: var(--ink);
        border: 1px solid #273042;
        border-radius: 8px;
        padding: 0.4rem 0.5rem;
      }

      [data-theme="light"] input[type="text"],
      [data-theme="light"] select,
      [data-theme="light"] input[type="number"] {
        background: #ffffff;
        color: #333333;
        border: 1px solid #666666;
      }

      input[type="file"] {
        width: 100%;
      }

      .hint {
        color: #9aa3b2;
        font-size: 0.85rem;
      }

      .kbd {
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
          "Liberation Mono", "Courier New", monospace;
        padding: 0.05rem 0.35rem;
        background: #0b0f16;
        border: 1px solid #273042;
        border-radius: 6px;
      }

      [data-theme="light"] .kbd {
        background: #e5e7eb;
        border: 1px solid #9ca3af;
        color: #333333;
      }

      #editorWrap {
        position: relative;
        flex: 1;
        display: flex;
        flex-direction: column;
        min-height: 0;
      }

      #svg {
        width: 100%;
        height: 100%;
        display: block;
        background: var(--bg);
        flex: 1;
      }

      #gridRect {
        pointer-events: all;
      }

      .overlayTip {
        position: absolute;
        left: 10px;
        top: 10px;
        background: rgba(14, 18, 25, 0.75);
        border: 1px solid #273042;
        padding: 0.35rem 0.5rem;
        border-radius: 8px;
        font-size: 0.85rem;
        z-index: 10;
      }

      [data-theme="light"] .overlayTip {
        background: rgba(255, 255, 255, 0.9);
        border: 1px solid #9ca3af;
        color: #333333;
      }

      #coordDisplay {
        top: 10px !important;
        left: 10px !important;
        bottom: auto !important;
      }

      /* Hover cues for hit-testing feedback */
      .wire-stroke {
        transition: stroke 0.08s ease, filter 0.08s ease;
      }

      .wire-stroke.hover {
        stroke: var(--select);
        filter: drop-shadow(0 0 2px rgba(245, 158, 11, 0.6));
      }

      /* Selected component: tint only its symbol graphics (not pins/text/hitbox) */
      #components g.comp.selected > g line,
      #components g.comp.selected > g path,
      #components g.comp.selected > g polyline,
      #components g.comp.selected > g circle,
      #components g.comp.selected > g rect {
        stroke: var(--select) !important;
        filter: drop-shadow(0 0 2px rgba(245, 158, 11, 0.6));
      }

      /* If a symbol element is filled (e.g., transistor arrow), color its fill too */
      #components g.comp.selected > g [fill="var(--component)"] {
        fill: var(--select) !important;
      }

      /* Keep strokes visually consistent when zooming the SVG viewBox */
      svg line,
      svg path,
      svg polyline,
      svg circle {
        vector-effect: non-scaling-stroke;
      }

      /* Crosshair overlay while wiring */
      body.mode-wire #svg {
        cursor: crosshair;
      }

      /* Pan cursors */
      body.mode-pan #svg {
        cursor: grab;
      }

      body.mode-pan.panning #svg {
        cursor: grabbing;
      }

      /* Also show grabbing during mid-mouse pan even if not in Pan mode */
      body.panning #svg {
        cursor: grabbing;
      }

      /* Crosshair styles are now set inline via JavaScript based on mode */
      /* Marquee selection box (drawn in #overlay) */
      #overlay rect.marquee {
        fill: rgba(245, 158, 11, 0.12);
        /* subtle fill */
        stroke: var(--select);
        /* stroke-width and stroke-dasharray are set dynamically based on zoom */
        pointer-events: none;
      }

      /* Inspector value + units on a single line, no wrapping */
      #inspector .hstack {
        display: flex;
        gap: 8px;
        align-items: center;
      }

      #inspector .hstack input[type="text"] {
        flex: 1 1 0;
        min-width: 0;
      }

      /* wide value box */
      /* Units dropdown: measure to content via JS, but cap visually via CSS too */
      #inspector .hstack select {
        flex: 0 0 auto;
        min-width: 72px;
        max-width: 50%;
        /* hard cap: never exceed half the row */
        white-space: nowrap;
        width: auto;
        /* prevent global select{width:100%} */
      }

      /* Swatch-only dropdowns */
      #wireColorGroup {
        position: relative;
      }

      .palette {
        position: absolute;
        top: 100%;
        left: 0;
        margin-top: 6px;
        background: var(--panel);
        border: 1px solid #273042;
        padding: 6px;
        border-radius: 8px;
        display: grid;
        grid-template-columns: repeat(7, 20px);
        gap: 6px;
        z-index: 7;
      }

      [data-theme="light"] .palette {
        background: var(--panel);
        border: 1px solid #d1d5db;
      }

      .palette .swatch-btn {
        width: 20px;
        height: 20px;
        border: 1px solid #273042;
        border-radius: 4px;
        cursor: pointer;
      }

      [data-theme="light"] .palette .swatch-btn {
        border: 1px solid #d1d5db;
      }

      .palette .swatch-btn.selected {
        outline: 2px solid var(--accent);
      }

      #wireColorBtn .swatch {
        width: 16px;
        height: 16px;
      }

      /* Inspector wire-color holder must be relative for its palette */
      .inspector-color {
        position: relative;
      }

      .inspector-color .palette {
        top: calc(100% + 6px);
        left: 0;
      }

      /* Grid button dim/off visual */
      .group button.dim {
        color: var(--muted);
        opacity: 0.75;
        font-weight: 400;
      }

      /* Grid ON: green outline */
      .group button.grid-on {
        box-shadow: 0 0 0 2px rgba(74, 222, 128, 0.15),
          inset 0 0 0 1px var(--ok);
      }

      /* Grid OFF: red outline */
      .group button.grid-off {
        box-shadow: 0 0 0 2px rgba(255, 107, 107, 0.12),
          inset 0 0 0 1px var(--danger);
      }

      /* Status bar in center column */
      #statusBar {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.4rem 0.75rem;
        background: var(--panel);
        border-top: 1px solid #22262f;
        font-size: 0.85rem;
        z-index: 3;
        flex-shrink: 0;
      }

      [data-theme="light"] #statusBar {
        border-top: 1px solid #d1d5db;
      }

      #statusBar .status-group {
        display: flex;
        gap: 0.25rem;
        align-items: center;
        background: #0e1219;
        padding: 0.15rem 0.3rem;
        border-radius: 8px;
        border: 1px solid #1e2430;
      }

      [data-theme="light"] #statusBar .status-group {
        background: #e5e7eb;
        border: 1px solid #d1d5db;
      }

      #statusBar button {
        padding: 0.3rem 0.5rem;
        font-size: 0.82rem;
        min-width: unset;
      }

      #statusBar select {
        padding: 0.3rem 0.4rem;
        font-size: 0.82rem;
        width: auto;
        min-width: 60px;
      }

      #statusBar .status-info {
        margin-left: auto;
        color: #9aa3b2;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      /* Apply same status button styles as header buttons */
      #statusBar .status-group button.dim {
        color: var(--muted);
        opacity: 0.75;
        font-weight: 400;
      }

      #statusBar .status-group button.grid-on {
        box-shadow: 0 0 0 2px rgba(74, 222, 128, 0.15),
          inset 0 0 0 1px var(--ok);
      }

      #statusBar .status-group button.grid-off {
        box-shadow: 0 0 0 2px rgba(255, 107, 107, 0.12),
          inset 0 0 0 1px var(--danger);
      }

      #statusBar .coord-input-group {
        display: flex;
        gap: 4px;
        align-items: center;
        padding: 0 8px;
        font-size: 13px;
      }

      #statusBar .coord-input-group label {
        font-weight: 500;
        color: var(--fg);
        margin-right: 2px;
      }

      #statusBar .coord-input-group input {
        width: 80px;
        padding: 2px 6px;
        background: var(--bg);
        border: 1px solid var(--border);
        border-radius: 3px;
        color: var(--fg);
        font-size: 12px;
        font-family: "SF Mono", Monaco, monospace;
        text-align: right;
      }

      #statusBar .coord-input-group input:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);
      }

      [data-theme="light"] #statusBar .coord-input-group input {
        background: #fff;
        border-color: #d1d5db;
      }
    </style>
  </head>

  <body>
    <div class="app">
      <header id="mainHeader">
        <div class="group" id="modeGroup">
          <button
            id="selectModeBtn"
            data-mode="select"
            class="active"
            title="Select/Move (V)"
          >
            Select
          </button>
          <button data-mode="wire" title="Wire (W)">Wire</button>
          <button data-mode="delete" title="Delete (Del)">Delete</button>
          <button data-mode="pan" title="Pan (P or MMB drag)">Pan</button>
          <button data-mode="move" title="Move selected (M / Arrow keys)">
            Move
          </button>
        </div>
        <div class="group" id="junctionDotGroup">
          <button id="placeJunctionDotBtn" title="Place Junction Dot">
            <svg
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <!-- Plus/crosshair -->
              <line x1="12" y1="6" x2="12" y2="10" />
              <line x1="12" y1="14" x2="12" y2="18" />
              <line x1="6" y1="12" x2="10" y2="12" />
              <line x1="14" y1="12" x2="18" y2="12" />
              <!-- Center dot (filled) -->
              <circle cx="12" cy="12" r="4" fill="currentColor" stroke="none" />
            </svg>
          </button>
          <button id="deleteJunctionDotBtn" title="Delete Junction Dot">
            <svg
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <!-- Center dot (filled) -->
              <circle cx="12" cy="12" r="4" fill="currentColor" stroke="none" />
              <!-- X over it -->
              <line x1="6" y1="6" x2="18" y2="18" />
              <line x1="18" y1="6" x2="6" y2="18" />
            </svg>
          </button>
        </div>
        <div class="group">
          <button id="undoBtn" title="Undo (Ctrl+Z)" disabled>
            <svg
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M9 14L4 9L9 4" />
              <path d="M20 20V14.5C20 11.4624 17.5376 9 14.5 9H4" />
            </svg>
          </button>
          <button id="redoBtn" title="Redo (Ctrl+Y)" disabled>
            <svg
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M15 14L20 9L15 4" />
              <path d="M4 20V14.5C4 11.4624 6.46243 9 9.5 9H20" />
            </svg>
          </button>
        </div>
        <div class="vsep"></div>
        <div class="group" id="paletteRow1">
          <button data-tool="resistor" title="Place Resistor (R)">
            <svg
              width="32"
              height="12"
              viewBox="0 0 64 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M2 12H10L14 6L22 18L30 6L38 18L46 6L54 18L58 12H62" />
            </svg>
          </button>
          <button data-tool="capacitor" title="Place Capacitor (C)">
            <svg
              width="32"
              height="12"
              viewBox="0 0 64 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M2 12H26" />
              <path d="M26 4V20" />
              <path d="M38 4V20" />
              <path d="M38 12H62" />
            </svg>
          </button>
          <button data-tool="inductor" title="Place Inductor (L)">
            <svg
              width="32"
              height="12"
              viewBox="0 0 64 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <!-- Left lead -->
              <line x1="2" y1="12" x2="14" y2="12" />
              <!-- 4 semicircular coils -->
              <path
                d="M14 12 a4 4 0 0 1 8 0 a4 4 0 0 1 8 0 a4 4 0 0 1 8 0 a4 4 0 0 1 8 0"
              />
              <!-- Right lead -->
              <line x1="46" y1="12" x2="62" y2="12" />
            </svg>
          </button>
          <button data-tool="diode" title="Place Diode (D)">
            <svg
              width="32"
              height="12"
              viewBox="0 0 64 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <g transform="rotate(180 32 12)">
                <!-- Anode lead -->
                <line x1="2" y1="12" x2="25" y2="12" />
                <!-- Triangle -->
                <path d="M25 4 L41 12 L25 20 Z" />
                <!-- Cathode bar -->
                <line x1="41" y1="4" x2="41" y2="20" />
                <!-- Cathode lead -->
                <line x1="41" y1="12" x2="62" y2="12" />
              </g>
            </svg>
          </button>
          <button data-tool="transistor" title="Place Transistor (Q)">
            <svg
              width="32"
              height="32"
              viewBox="0 0 64 64"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <!-- Circle body -->
              <circle cx="32" cy="32" r="18" />
              <!-- Collector vertical lead -->
              <line x1="32" y1="7" x2="32" y2="18" />
              <!-- Emitter vertical lead -->
              <line x1="32" y1="57" x2="32" y2="48" />
              <!-- Base electrode inside circle -->
              <line x1="24" y1="22" x2="24" y2="42" />
              <!-- Base lead external -->
              <line x1="7" y1="32" x2="24" y2="32" />
              <!-- Internal connection to collector -->
              <line x1="24" y1="24" x2="32" y2="18" />
              <!-- Internal connection to emitter -->
              <line x1="24" y1="40" x2="32" y2="48" />
              <!-- Arrow (NPN - pointing out) -->
              <line x1="31.5" y1="47.5" x2="27" y2="46" />
              <line x1="31.5" y1="47.5" x2="30" y1="43" />
            </svg>
          </button>
          <button data-tool="ground" title="Earth Ground">
            <svg
              width="32"
              height="28"
              viewBox="0 0 64 56"
              fill="none"
              stroke="currentColor"
              stroke-width="4"
              stroke-linecap="round"
            >
              <line x1="12" y1="12" x2="52" y2="12" />
              <line x1="20" y1="26" x2="44" y2="26" />
              <line x1="28" y1="40" x2="36" y2="40" />
            </svg>
          </button>
          <button data-tool="battery" title="Place Battery">Battery</button>
          <button data-tool="ac" title="Place AC Source">AC Source</button>
        </div>
        <!-- Sub-type row (appears when a type with subtypes is active; for: Diode, Capacitor) -->
        <div class="group" id="paletteRow2" style="display: none">
          <select id="diodeSelect" title="Diode subtype">
            <option value="generic" selected>Generic</option>
            <option value="schottky">Schottky</option>
            <option value="zener">Zener</option>
            <option value="led">Light-emitting (LED)</option>
            <option value="photo">Photo</option>
            <option value="tunnel">Tunnel</option>
            <option value="varactor">Varactor / Varicap</option>
            <option value="laser">Laser diode</option>
            <option
              value="tvs_uni"
              title="Unidirectional Transient Voltage Suppressor diode"
            >
              TVS Unidirectional
            </option>
            <option
              value="tvs_bi"
              title="Bidirectional Transient Voltage Suppressor diode"
            >
              TVS Bidirectional
            </option>
          </select>
          <div class="capacitor-subtypes">
            <button
              id="capacitorStandard"
              data-subtype="standard"
              title="Standard Capacitor"
            >
              <svg
                viewBox="0 0 64 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M2 12H26" />
                <path d="M26 4V20" />
                <path d="M38 4V20" />
                <path d="M38 12H62" />
              </svg>
            </button>
            <button
              id="capacitorPolarized"
              data-subtype="polarized"
              title="Polarized Capacitor"
            >
              <svg
                viewBox="0 0 64 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M2 12H26" />
                <path d="M26 4V20" />
                <path d="M38 4 Q 32 12 38 20" />
                <path d="M38 12H62" />
              </svg>
            </button>
          </div>
          <div class="transistor-subtypes">
            <button
              id="transistorNPN"
              data-subtype="npn"
              title="NPN Transistor"
            >
              <svg
                viewBox="0 0 64 64"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <!-- Circle body -->
                <circle cx="32" cy="32" r="18" />
                <!-- Collector vertical lead -->
                <line x1="32" y1="7" x2="32" y2="18" />
                <!-- Emitter vertical lead -->
                <line x1="32" y1="57" x2="32" y2="48" />
                <!-- Base electrode inside circle -->
                <line x1="24" y1="22" x2="24" y2="42" />
                <!-- Base lead external -->
                <line x1="7" y1="32" x2="24" y2="32" />
                <!-- Internal connection to collector -->
                <line x1="24" y1="24" x2="32" y2="18" />
                <!-- Internal connection to emitter -->
                <line x1="24" y1="40" x2="32" y2="48" />
                <!-- Arrow (NPN - pointing out) -->
                <line x1="31.5" y1="47.5" x2="27" y2="46" />
                <line x1="31.5" y1="47.5" x2="30" y2="43" />
              </svg>
            </button>
            <button
              id="transistorPNP"
              data-subtype="pnp"
              title="PNP Transistor"
            >
              <svg
                viewBox="0 0 64 64"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <!-- Circle body -->
                <circle cx="32" cy="32" r="18" />
                <!-- Collector vertical lead -->
                <line x1="32" y1="7" x2="32" y2="18" />
                <!-- Emitter vertical lead -->
                <line x1="32" y1="57" x2="32" y2="48" />
                <!-- Base electrode inside circle -->
                <line x1="24" y1="22" x2="24" y2="42" />
                <!-- Base lead external -->
                <line x1="7" y1="32" x2="24" y2="32" />
                <!-- Internal connection to collector -->
                <line x1="24" y1="24" x2="32" y2="18" />
                <!-- Internal connection to emitter -->
                <line x1="24" y1="40" x2="32" y2="48" />
                <!-- Arrow (PNP - pointing in) -->
                <line x1="26" y1="42" x2="30" y2="46" />
                <line x1="26" y1="42" x2="30" y2="44" />
              </svg>
            </button>
          </div>
        </div>
        <div class="group">
          <button id="rotateBtn" title="Rotate 90° (R)">Rotate</button>
          <button id="clearBtn" class="danger" title="Clear (Ctrl+K)">
            Clear
          </button>
        </div>
        <div
          class="group"
          id="wireColorGroup"
          title="Wire color (new wires only)"
        >
          <button id="wireColorBtn" title="Wire color">
            <span style="color: #9aa3b2; margin-right: 0.25rem">Wire</span>
            <span id="wireColorSwatch" class="swatch"></span>
          </button>
          <div id="wireColorMenu" class="palette" style="display: none"></div>
        </div>
        <div class="group">
          <button id="zoomOutBtn" title="Zoom Out (−)">−</button>
          <button id="zoomInBtn" title="Zoom In (+)">+</button>
          <button id="zoomResetBtn" title="Reset Zoom (1:1)">100%</button>
          <input
            id="zoomPct"
            type="text"
            value="100%"
            title="Zoom % (editable)"
            style="width: 6ch; text-align: right"
          />
        </div>
        <div class="group">
          <button id="saveBtn" class="ok" title="Save JSON (Ctrl+S)">
            Save
          </button>
          <button id="loadBtn" title="Load JSON">Load</button>
          <input
            id="fileInput"
            type="file"
            accept="application/json"
            style="display: none"
          />
        </div>
        <div class="group">
          <button id="importBtn" title="Import KiCad Symbol">Import</button>
          <input
            id="importFileInput"
            type="file"
            accept=".kicad_sym"
            style="display: none"
          />
        </div>
        <div class="group">
          <button
            id="helpBtn"
            title="Help & Documentation"
            onclick="window.open('help.html', '_blank')"
          >
            Help
          </button>
        </div>
      </header>
      <div class="app-body">
        <aside id="left" class="panel">
          <div class="panel-header">
            <h2>Inspector</h2>
            <button
              class="panel-toggle"
              data-panel="left"
              title="Collapse/Expand"
            >
              ◀
            </button>
          </div>
          <div class="panel-content">
            <div id="inspectorNone" class="hint">
              Select a component or wire to edit its properties.
            </div>
            <div id="inspector"></div>
            <hr style="border-color: #22262f; margin: 1rem 0" />
            <h2>Tips</h2>
            <ul class="hint" style="line-height: 1.5">
              <li>
                <span class="kbd">V</span> Select/Move ·
                <span class="kbd">W</span> Wire ·
                <span class="kbd">Del</span> Delete
              </li>
              <li>
                Click grid to place selected part. Drag to move.
                <span class="kbd">R</span> rotates a part.
              </li>
              <li>
                Wiring: click start → click turns → double‑click or
                <span class="kbd">Enter</span> to finish.
                <span class="kbd">Esc</span> to cancel.
              </li>
              <li>
                Select: click-drag on empty space to draw a marquee window.
                Release to select (by default, the nearest
                <em>wire segment</em> in the box). Hold
                <span class="kbd">Shift</span> while dragging to prefer
                <em>components</em> instead. Click empty space to clear.
              </li>
              <li>
                Delete: click a wire <em>segment</em> or component to remove.
              </li>
            </ul>
          </div>
        </aside>
        <div class="resizer" data-resizer="left"></div>
        <div class="center-column">
          <main id="center">
            <div id="editorWrap">
              <svg
                id="svg"
                viewBox="0 0 1600 1000"
                xmlns="http://www.w3.org/2000/svg"
              >
                <defs>
                  <pattern
                    id="grid"
                    width="24"
                    height="24"
                    patternUnits="userSpaceOnUse"
                  >
                    <path
                      d="M24 0H0V24"
                      fill="none"
                      stroke="var(--grid)"
                      stroke-width="1"
                    />
                  </pattern>
                  <pattern
                    id="gridBold"
                    width="120"
                    height="120"
                    patternUnits="userSpaceOnUse"
                  >
                    <rect width="120" height="120" fill="url(#grid)" />
                    <path
                      d="M120 0H0V120"
                      fill="none"
                      stroke="var(--grid-bold)"
                      stroke-width="1.5"
                    />
                  </pattern>
                  <!-- Marker for wire endpoints when drawing -->
                  <marker
                    id="dot"
                    viewBox="0 0 10 10"
                    refX="5"
                    refY="5"
                    markerWidth="5"
                    markerHeight="5"
                  >
                    <circle cx="5" cy="5" r="3" fill="var(--wire)" />
                  </marker>
                </defs>
                <rect
                  id="gridRect"
                  x="0"
                  y="0"
                  width="1600"
                  height="1000"
                  fill="url(#gridBold)"
                />
                <g id="dotGrid"></g>
                <g id="wires"></g>
                <g id="junctions"></g>
                <g id="components"></g>
                <g id="drawing"></g>
                <g id="overlay" class="crosshair"></g>
              </svg>
              <div
                class="overlayTip"
                id="coordDisplay"
                style="display: none"
              ></div>
            </div>
          </main>
          <footer id="statusBar">
            <div class="status-group">
              <button id="orthoToggleBtn" title="Ortho mode (O)">Ortho</button>
              <button id="snapToggleBtn" title="Snap mode (S)">50mil</button>
              <button id="gridUnitBtn" title="Grid Units: Imperial/Metric (U)">
                mil
              </button>
              <button id="gridToggleBtn" title="Toggle Grid (G)">Grid</button>
            </div>
            <div class="status-group">
              <button
                id="crosshairToggleBtn"
                title="Toggle Crosshair Length (X)"
              >
                <svg
                  width="16"
                  height="16"
                  viewBox="0 0 16 16"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <line
                    x1="8"
                    y1="0"
                    x2="8"
                    y2="16"
                    stroke="currentColor"
                    stroke-width="1.5"
                    class="crosshair-full"
                  />
                  <line
                    x1="0"
                    y1="8"
                    x2="16"
                    y2="8"
                    stroke="currentColor"
                    stroke-width="1.5"
                    class="crosshair-full"
                  />
                  <line
                    x1="8"
                    y1="4"
                    x2="8"
                    y2="12"
                    stroke="currentColor"
                    stroke-width="1.5"
                    class="crosshair-short"
                    style="display: none"
                  />
                  <line
                    x1="4"
                    y1="8"
                    x2="12"
                    y2="8"
                    stroke="currentColor"
                    stroke-width="1.5"
                    class="crosshair-short"
                    style="display: none"
                  />
                </svg>
              </button>
              <button id="junctionDotsBtn" title="Toggle Junction Dots">
                <svg
                  width="16"
                  height="16"
                  viewBox="0 0 16 16"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <circle cx="8" cy="8" r="3" fill="currentColor" />
                </svg>
              </button>
              <button id="trackingToggleBtn" title="Toggle Tracking (T)">
                <svg
                  width="16"
                  height="16"
                  viewBox="0 0 16 16"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <line
                    x1="2"
                    y1="12"
                    x2="12"
                    y2="12"
                    stroke="currentColor"
                    stroke-width="1.5"
                  />
                  <line
                    x1="12"
                    y1="12"
                    x2="12"
                    y2="4"
                    stroke="#4CAF50"
                    stroke-width="1.5"
                    stroke-dasharray="2,2"
                  />
                  <circle cx="12" cy="4" r="1.5" fill="#4CAF50" />
                  <circle cx="12" cy="12" r="1.5" fill="#4CAF50" />
                </svg>
              </button>
            </div>
            <div class="status-group">
              <button id="themeToggleBtn" title="Toggle Dark/Light Theme">
                ☀
              </button>
              <select id="unitsSelect" title="Display Units">
                <option value="mm">mm</option>
                <option value="in">in</option>
                <option value="mils" selected>mils</option>
              </select>
            </div>
            <div
              class="coord-input-group"
              id="coordInputGroup"
              style="display: none"
            >
              <label for="coordInputX">X:</label>
              <input
                type="text"
                id="coordInputX"
                title="X coordinate (type to enter, Tab for Y, Enter to accept)"
              />
              <label for="coordInputY">Y:</label>
              <input
                type="text"
                id="coordInputY"
                title="Y coordinate (Tab/Shift+Tab to switch, Enter to accept)"
              />
            </div>
            <div
              class="coord-input-group"
              id="polarInputGroup"
              style="display: none"
            >
              <label for="coordInputLength">L:</label>
              <input
                type="text"
                id="coordInputLength"
                title="Length from previous point (Tab for angle, Enter to accept)"
              />
              <label for="coordInputAngle">∠:</label>
              <input
                type="text"
                id="coordInputAngle"
                title="Angle in degrees (0° = right, 90° = up, Tab for length, Enter to accept)"
              />
            </div>
            <div class="status-info">
              Mode: <b id="modeLabel">Select</b> · Grid:
              <span id="gridSizeKbd" class="kbd">24px</span> · Snap:
              <span id="snapKbd" class="kbd">on</span>
            </div>
          </footer>
        </div>
        <div class="resizer" data-resizer="right"></div>
        <aside id="right" class="panel">
          <div class="panel-header">
            <h2>Project</h2>
            <button
              class="panel-toggle"
              data-panel="right"
              title="Collapse/Expand"
            >
              ▶
            </button>
          </div>
          <div class="panel-content">
            <div class="row"><label for="projTitle">Title</label></div>
            <div class="row">
              <input
                id="projTitle"
                type="text"
                placeholder="Untitled schematic"
              />
            </div>
            <div class="row hint">Saved into JSON</div>
            <hr style="border-color: #22262f; margin: 1rem 0" />
            <div class="section-header" data-section="settings">
              <h2>Settings</h2>
              <span class="section-toggle">▼</span>
            </div>

            <div class="section-content" data-section-content="settings">
              <div class="row">
                <label for="defaultResistorStyleSelect"
                  >Schematic Standard</label
                >
              </div>
              <div class="row">
                <select id="defaultResistorStyleSelect">
                  <option value="ansi" selected>ANSI/IEEE (US)</option>
                  <option value="iec">IEC (International)</option>
                </select>
              </div>
              <div class="row hint">Default for new components</div>

              <div
                class="section-header"
                data-section="settings-symbols"
                style="margin-top: 0.75rem"
              >
                <h3>Symbols</h3>
                <span class="section-toggle">▼</span>
              </div>
              <div
                class="section-content"
                data-section-content="settings-symbols"
              >
                <div class="row" style="align-items: center">
                  <label for="symbolColorBody" style="flex: 1">Body</label>
                  <input
                    type="color"
                    id="symbolColorBody"
                    data-symbol-key="body"
                    style="width: 40px; height: 32px; cursor: pointer"
                    title="Set body stroke color"
                  />
                  <span
                    id="symbolColorBodyValue"
                    style="
                      font-family: monospace;
                      font-size: 0.85rem;
                      min-width: 6ch;
                      text-align: right;
                      color: var(--muted);
                    "
                    >#202020</span
                  >
                </div>
                <div class="row" style="align-items: center">
                  <label for="symbolColorPin" style="flex: 1">Pin</label>
                  <input
                    type="color"
                    id="symbolColorPin"
                    data-symbol-key="pin"
                    style="width: 40px; height: 32px; cursor: pointer"
                    title="Set pin color"
                  />
                  <span
                    id="symbolColorPinValue"
                    style="
                      font-family: monospace;
                      font-size: 0.85rem;
                      min-width: 6ch;
                      text-align: right;
                      color: var(--muted);
                    "
                    >#202020</span
                  >
                </div>
                <div class="row" style="align-items: center">
                  <label for="symbolColorPinText" style="flex: 1"
                    >Pin Text</label
                  >
                  <input
                    type="color"
                    id="symbolColorPinText"
                    data-symbol-key="pinText"
                    style="width: 40px; height: 32px; cursor: pointer"
                    title="Set pin text color"
                  />
                  <span
                    id="symbolColorPinTextValue"
                    style="
                      font-family: monospace;
                      font-size: 0.85rem;
                      min-width: 6ch;
                      text-align: right;
                      color: var(--muted);
                    "
                    >#202020</span
                  >
                </div>
                <div class="row" style="align-items: center">
                  <label for="symbolColorReferenceText" style="flex: 1"
                    >Reference Text</label
                  >
                  <input
                    type="color"
                    id="symbolColorReferenceText"
                    data-symbol-key="referenceText"
                    style="width: 40px; height: 32px; cursor: pointer"
                    title="Set reference text color"
                  />
                  <span
                    id="symbolColorReferenceTextValue"
                    style="
                      font-family: monospace;
                      font-size: 0.85rem;
                      min-width: 6ch;
                      text-align: right;
                      color: var(--muted);
                    "
                    >#202020</span
                  >
                </div>
                <div class="row" style="align-items: center">
                  <label for="symbolColorValueText" style="flex: 1"
                    >Value Text</label
                  >
                  <input
                    type="color"
                    id="symbolColorValueText"
                    data-symbol-key="valueText"
                    style="width: 40px; height: 32px; cursor: pointer"
                    title="Set value text color"
                  />
                  <span
                    id="symbolColorValueTextValue"
                    style="
                      font-family: monospace;
                      font-size: 0.85rem;
                      min-width: 6ch;
                      text-align: right;
                      color: var(--muted);
                    "
                    >#202020</span
                  >
                </div>
                <div class="row" style="align-items: center">
                  <label for="symbolColorPowerSymbol" style="flex: 1"
                    >Power Symbol</label
                  >
                  <input
                    type="color"
                    id="symbolColorPowerSymbol"
                    data-symbol-key="powerSymbol"
                    style="width: 40px; height: 32px; cursor: pointer"
                    title="Set power symbol color"
                  />
                  <span
                    id="symbolColorPowerSymbolValue"
                    style="
                      font-family: monospace;
                      font-size: 0.85rem;
                      min-width: 6ch;
                      text-align: right;
                      color: var(--muted);
                    "
                    >#202020</span
                  >
                </div>
                <div class="row" style="justify-content: flex-end">
                  <button
                    type="button"
                    id="resetSymbolColorsBtn"
                    style="
                      padding: 0.45rem 0.9rem;
                      background: var(--muted);
                      color: var(--ink);
                      border: none;
                      border-radius: 4px;
                      cursor: pointer;
                      font-weight: 600;
                    "
                  >
                    Reset
                  </button>
                </div>
              </div>
              <div
                class="section-header"
                data-section="junction-dots"
                style="margin-top: 0.75rem"
              >
                <h3>Junction Dots</h3>
                <span class="section-toggle">▼</span>
              </div>
              <div class="section-content" data-section-content="junction-dots">
                <fieldset
                  class="row"
                  id="junctionDotSizeFieldset"
                  style="border: 0; padding: 0; margin: 0"
                >
                  <legend
                    style="
                      color: var(--muted);
                      font-size: 0.9rem;
                      margin-bottom: 0.25rem;
                    "
                  >
                    Junction Dot Size
                  </legend>
                  <div
                    id="junctionDotSizeSelect"
                    class="junction-size-selector"
                    role="radiogroup"
                    aria-label="Junction Dot Size"
                  >
                    <button
                      type="button"
                      class="junction-size-option"
                      data-size="smallest"
                      title="Smallest (15 mils / 0.381mm)"
                    >
                      <svg width="24" height="24" viewBox="0 0 24 24">
                        <circle
                          cx="12"
                          cy="12"
                          r="1.5"
                          fill="currentColor"
                          stroke="var(--bg)"
                          stroke-width="1"
                        />
                      </svg>
                    </button>
                    <button
                      type="button"
                      class="junction-size-option"
                      data-size="small"
                      title="Small (30 mils / 0.762mm)"
                    >
                      <svg width="24" height="24" viewBox="0 0 24 24">
                        <circle
                          cx="12"
                          cy="12"
                          r="3.0"
                          fill="currentColor"
                          stroke="var(--bg)"
                          stroke-width="1"
                        />
                      </svg>
                    </button>
                    <button
                      type="button"
                      class="junction-size-option selected"
                      data-size="default"
                      title="Default (40 mils / 1.016mm)"
                    >
                      <svg width="24" height="24" viewBox="0 0 24 24">
                        <circle
                          cx="12"
                          cy="12"
                          r="4.0"
                          fill="currentColor"
                          stroke="var(--bg)"
                          stroke-width="1"
                        />
                      </svg>
                    </button>
                    <button
                      type="button"
                      class="junction-size-option"
                      data-size="large"
                      title="Large (50 mils / 1.27mm)"
                    >
                      <svg width="24" height="24" viewBox="0 0 24 24">
                        <circle
                          cx="12"
                          cy="12"
                          r="5.0"
                          fill="currentColor"
                          stroke="var(--bg)"
                          stroke-width="1"
                        />
                      </svg>
                    </button>
                    <button
                      type="button"
                      class="junction-size-option"
                      data-size="largest"
                      title="Largest (65 mils / 1.651mm)"
                    >
                      <svg width="24" height="24" viewBox="0 0 24 24">
                        <circle
                          cx="12"
                          cy="12"
                          r="6.5"
                          fill="currentColor"
                          stroke="var(--bg)"
                          stroke-width="1"
                        />
                      </svg>
                    </button>
                    <button
                      type="button"
                      class="junction-size-option"
                      id="junctionCustomPreview"
                      data-size="custom"
                      title="Custom"
                      style="display: none"
                    >
                      <svg
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                        id="junctionCustomPreviewSvg"
                      >
                        <!-- Dynamic content -->
                      </svg>
                    </button>
                  </div>
                </fieldset>
                <div class="row">
                  <label
                    for="junctionCustomSizeInput"
                    id="junctionCustomSizeLabel"
                    >Custom Junction Size (mils)</label
                  >
                </div>
                <div class="row">
                  <input
                    type="text"
                    id="junctionCustomSizeInput"
                    placeholder="Optional"
                    style="width: 12ch"
                  />
                </div>
                <div class="row">
                  <label for="junctionDefaultColorPicker"
                    >Default Junction Color</label
                  >
                </div>
                <div class="row">
                  <input
                    type="color"
                    id="junctionDefaultColorPicker"
                    style="min-width: 32px; height: 32px; cursor: pointer"
                    title="Choose default junction color"
                  />
                  <input
                    type="range"
                    id="junctionDefaultOpacity"
                    min="0"
                    max="1"
                    step="0.05"
                    value="1"
                    style="flex: 0 0 120px; margin-left: 0.5rem"
                    title="Opacity"
                  />
                </div>
                <div
                  class="row"
                  id="junctionColorSwatches"
                  style="gap: 4px; flex-wrap: wrap; margin-top: 0.5rem"
                >
                  <!-- Color swatches will be added by JavaScript -->
                </div>
                <div class="row hint">
                  Default color for junction dots (uses net class if not set)
                </div>
              </div>
            </div>

            <hr style="border-color: #22262f; margin: 1rem 0" />
            <div class="section-header" data-section="nets">
              <h2>Nets</h2>
              <span class="section-toggle">▼</span>
            </div>
            <div class="section-content" data-section-content="nets">
              <div id="netList" class="hint">—</div>
              <button id="addNetBtn" style="margin-top: 0.5rem; width: 100%">
                Add Net
              </button>
            </div>

            <div
              class="section-header"
              data-section="constraints"
              style="margin-top: 1rem"
            >
              <h2>Constraints</h2>
              <span class="section-toggle">▼</span>
            </div>
            <div class="section-content" data-section-content="constraints">
              <!-- Component Clearance UI is injected here programmatically -->
            </div>

            <!-- Junction Dots subsection moved into Settings (rendered below as an h3 subsection) -->

            <div
              class="section-header"
              data-section="light-bg"
              style="margin-top: 1rem"
            >
              <h2>Light Theme Background</h2>
              <span class="section-toggle">▼</span>
            </div>
            <div class="section-content" data-section-content="light-bg">
              <div class="row">
                <label for="lightBgColorPicker">Light Theme Background</label>
              </div>
              <div class="row">
                <div
                  id="lightBgColorSwatches"
                  style="
                    display: flex;
                    gap: 0.25rem;
                    flex-wrap: wrap;
                    margin-bottom: 0.5rem;
                  "
                >
                  <button
                    type="button"
                    class="color-swatch"
                    data-color="#e8e8e8"
                    data-permanent="true"
                    title="Default Gray"
                    style="
                      background: #e8e8e8;
                      width: 32px;
                      height: 32px;
                      border: 2px solid var(--muted);
                      border-radius: 4px;
                      cursor: pointer;
                    "
                  ></button>
                  <button
                    type="button"
                    class="color-swatch"
                    data-color="#FFFEDF"
                    data-permanent="true"
                    title="Warm Cream"
                    style="
                      background: #fffedf;
                      width: 32px;
                      height: 32px;
                      border: 2px solid var(--muted);
                      border-radius: 4px;
                      cursor: pointer;
                    "
                  ></button>
                  <button
                    type="button"
                    class="color-swatch"
                    data-color="#ffffff"
                    data-permanent="true"
                    title="Pure White"
                    style="
                      background: #ffffff;
                      width: 32px;
                      height: 32px;
                      border: 2px solid var(--muted);
                      border-radius: 4px;
                      cursor: pointer;
                    "
                  ></button>
                  <button
                    type="button"
                    class="color-swatch"
                    data-color="#f0f4f8"
                    data-permanent="true"
                    title="Cool Blue"
                    style="
                      background: #f0f4f8;
                      width: 32px;
                      height: 32px;
                      border: 2px solid var(--muted);
                      border-radius: 4px;
                      cursor: pointer;
                    "
                  ></button>
                  <button
                    type="button"
                    class="color-swatch"
                    data-color="#f5f5dc"
                    data-permanent="true"
                    title="Beige"
                    style="
                      background: #f5f5dc;
                      width: 32px;
                      height: 32px;
                      border: 2px solid var(--muted);
                      border-radius: 4px;
                      cursor: pointer;
                    "
                  ></button>
                </div>
                <div style="display: flex; gap: 0.5rem; align-items: flex-end">
                  <input
                    type="color"
                    id="lightBgColorPicker"
                    value="#e8e8e8"
                    style="flex: 1; height: 32px; cursor: pointer"
                    title="Choose custom color"
                  />
                  <button
                    type="button"
                    id="resetLightBgColorBtn"
                    style="
                      padding: 0.45rem 0.9rem;
                      background: var(--muted);
                      color: var(--ink);
                      border: none;
                      border-radius: 4px;
                      cursor: pointer;
                      font-weight: 600;
                    "
                    title="Reset to default background"
                  >
                    Reset
                  </button>
                  <button
                    type="button"
                    id="deleteCustomColorBtn"
                    style="
                      width: 32px;
                      height: 32px;
                      background: var(--danger);
                      color: white;
                      border: none;
                      border-radius: 4px;
                      cursor: pointer;
                      font-weight: bold;
                      font-size: 16px;
                      display: flex;
                      align-items: center;
                      justify-content: center;
                      padding: 0;
                      line-height: 1;
                    "
                    title="Delete selected custom color"
                  >
                    ✕
                  </button>
                </div>
              </div>
              <div class="row hint">Background color for light theme</div>
            </div>
            <hr style="border-color: #22262f; margin: 1rem 0" />
            <h2>Counts</h2>
            <div class="hint" id="counts">—</div>
          </div>
        </aside>
      </div>
    </div>

    <script>
      (function () {
        var s = document.createElement("script");
        s.type = "module";
        s.src = "dist/app.js";
        document.currentScript.replaceWith(s);
      })();
    </script>

    <!-- Constraint System Test Button -->
    <script type="module">
      import { runAllExamples } from "./dist/constraints/examples.js";

      // Wire up the test button
      document.addEventListener("DOMContentLoaded", () => {
        const testBtn = document.getElementById("testConstraintsBtn");
        if (testBtn) {
          testBtn.addEventListener("click", () => {
            console.clear();
            console.log(
              "%c🧪 Testing Constraint System...",
              "font-size: 16px; font-weight: bold; color: #61dafb"
            );
            console.log(
              "%cCheck the console output below for test results",
              "color: #a5adbb"
            );
            console.log("─".repeat(80));

            try {
              runAllExamples();
              console.log("─".repeat(80));
              console.log(
                "%c✅ All tests completed successfully!",
                "font-size: 14px; font-weight: bold; color: #4ade80"
              );
              console.log(
                "%cThe constraint system is working correctly.",
                "color: #a5adbb"
              );
            } catch (error) {
              console.log("─".repeat(80));
              console.error(
                "%c❌ Test failed:",
                "font-size: 14px; font-weight: bold; color: #ff6b6b",
                error
              );
            }
          });
        }
      });
    </script>
  </body>
</html>
